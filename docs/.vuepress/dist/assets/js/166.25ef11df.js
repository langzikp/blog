(window.webpackJsonp=window.webpackJsonp||[]).push([[166],{599:function(t,s,a){"use strict";a.r(s);var r=a(34),e=Object(r.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"跨域问题及解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域问题及解决方案"}},[t._v("#")]),t._v(" 跨域问题及解决方案")]),t._v(" "),a("h2",{attrs:{id:"同源策略及跨域问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同源策略及跨域问题"}},[t._v("#")]),t._v(" 同源策略及跨域问题")]),t._v(" "),a("p",[a("strong",[t._v("同源策略")]),t._v("是一套浏览器"),a("strong",[t._v("安全机制")]),t._v("，当一个"),a("strong",[t._v("源")]),t._v("的文档和脚本，与另一个"),a("strong",[t._v("源")]),t._v("的资源进行通信时，同源策略就会对这个通信做出不同程度的限制。")]),t._v(" "),a("p",[t._v("简单来说，同源策略对 "),a("strong",[t._v("同源资源")]),t._v(" "),a("strong",[t._v("放行")]),t._v("，对 "),a("strong",[t._v("异源资源")]),t._v(" "),a("strong",[t._v("限制")])]),t._v(" "),a("p",[t._v("因此限制造成的开发问题，称之为"),a("strong",[t._v("跨域（异源）问题")])]),t._v(" "),a("h3",{attrs:{id:"同源和异源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同源和异源"}},[t._v("#")]),t._v(" 同源和异源")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("源(origin) = 协议 + 域名 + 端口\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("例如:")]),t._v(" "),a("p",[a("code",[t._v("https://study.duyiedu.com/api/movie")]),t._v("的源为"),a("code",[t._v("https://study.duyiedu.com")])]),t._v(" "),a("p",[a("code",[t._v("http://localhost:7001/index.html")]),t._v("的源为"),a("code",[t._v("http://localhost:7001")])]),t._v(" "),a("p",[t._v("两个URL地址的源"),a("strong",[t._v("完全相同")]),t._v("，则称之为"),a("strong",[t._v("同源")]),t._v("，否则称之为"),a("strong",[t._v("异源（跨域）")])]),t._v(" "),a("img",{attrs:{src:t.$withBase("/img/network/13.png"),alt:"图片"}}),t._v(" "),a("h3",{attrs:{id:"跨域出现的场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域出现的场景"}},[t._v("#")]),t._v(" 跨域出现的场景")]),t._v(" "),a("p",[t._v("跨域可能出现在三种场景：")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("网络通信")])]),t._v(" "),a("p",[t._v("a元素的跳转；加载css、js、图片等；AJAX等等")])]),t._v(" "),a("li",[a("p",[t._v("JS API")]),t._v(" "),a("p",[a("code",[t._v("window.open")]),t._v("、"),a("code",[t._v("window.parent")]),t._v("、"),a("code",[t._v("iframe.contentWindow")]),t._v("等等")])]),t._v(" "),a("li",[a("p",[t._v("存储")]),t._v(" "),a("p",[a("code",[t._v("WebStorage")]),t._v("、"),a("code",[t._v("IndexedDB")]),t._v("等等")])])]),t._v(" "),a("p",[t._v("对于不同的跨域场景，以及每个场景中不同的跨域方式，同源策略都有不同的限制。")]),t._v(" "),a("p",[t._v("本文重点讨论"),a("strong",[t._v("网络通信")]),t._v("中"),a("code",[t._v("AJAX")]),t._v("的跨域问题")]),t._v(" "),a("h3",{attrs:{id:"网络中的跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网络中的跨域"}},[t._v("#")]),t._v(" 网络中的跨域")]),t._v(" "),a("p",[t._v("当浏览器运行页面后，会发出很多的网络请求，例如CSS、JS、图片、AJAX等等")]),t._v(" "),a("p",[t._v("请求页面的源称之为"),a("strong",[t._v("页面源")]),t._v("，在该页面中发出的请求称之为"),a("strong",[t._v("目标源")]),t._v("。")]),t._v(" "),a("p",[t._v("当页面源和目标源一致时，则为"),a("strong",[t._v("同源请求")]),t._v("，否则为"),a("strong",[t._v("异源请求（跨域请求）")])]),t._v(" "),a("img",{attrs:{src:t.$withBase("/img/network/14.png"),alt:"图片"}}),t._v(" "),a("h3",{attrs:{id:"浏览器如何限制异源请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#浏览器如何限制异源请求"}},[t._v("#")]),t._v(" 浏览器如何限制异源请求？")]),t._v(" "),a("p",[t._v("浏览器出于多方面的考量，制定了非常繁杂的规则来限制各种跨域请求，但总体的原则非常简单：")]),t._v(" "),a("ul",[a("li",[t._v("对标签发出的跨域请求轻微限制")]),t._v(" "),a("li",[t._v("对AJAX发出的跨域请求"),a("strong",[t._v("严厉限制")])])]),t._v(" "),a("img",{attrs:{src:t.$withBase("/img/network/15.png"),alt:"图片"}}),t._v(" "),a("h2",{attrs:{id:"解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[t._v("#")]),t._v(" 解决方案")]),t._v(" "),a("h2",{attrs:{id:"cors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cors"}},[t._v("#")]),t._v(" CORS")]),t._v(" "),a("p",[t._v("CORS（Cross-Origin Resource Sharing）跨域资源共享，是最正统的跨域解决方案，同时也是浏览器推荐的解决方案。")]),t._v(" "),a("p",[t._v("CORS是一套规则，用于帮助浏览器判断是否校验通过。")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/img/network/16.png"),alt:"图片"}}),t._v(" "),a("p",[t._v("CORS的基本理念是：")]),t._v(" "),a("ul",[a("li",[t._v("只要服务器明确表示"),a("strong",[t._v("允许")]),t._v("，则校验"),a("strong",[t._v("通过")])]),t._v(" "),a("li",[t._v("服务器明确拒绝或没有表示，则校验不通过")])]),t._v(" "),a("p",[a("strong",[t._v("所以，使用CORS解决跨域，必须要保证服务器是「自己人」")])]),t._v(" "),a("h4",{attrs:{id:"请求分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#请求分类"}},[t._v("#")]),t._v(" 请求分类")]),t._v(" "),a("p",[t._v("CORS将请求分为两类：==简单请求==和==预检请求==。")]),t._v(" "),a("p",[t._v("对不同种类的请求它的规则有所区别。")]),t._v(" "),a("p",[t._v("所以要理解CORS，首先要理解它是如何划分请求的。")]),t._v(" "),a("h2",{attrs:{id:"简单请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简单请求"}},[t._v("#")]),t._v(" 简单请求")]),t._v(" "),a("blockquote",[a("p",[t._v("完整判定逻辑：https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple_requests")])]),t._v(" "),a("p",[t._v("简单来说，只要全部满足下列三个条件，就是简单请求：")]),t._v(" "),a("ul",[a("li",[a("ol",[a("li",[t._v("请求方法是"),a("code",[t._v("GET")]),t._v("、"),a("code",[t._v("POST")]),t._v("、"),a("code",[t._v("HEAD")]),t._v("之一")])])]),t._v(" "),a("li",[a("ol",{attrs:{start:"2"}},[a("li",[t._v("头部字段满足CORS安全规范，详见 "),a("a",{attrs:{href:"https://fetch.spec.whatwg.org/#cors-safelisted-request-header",target:"_blank",rel:"noopener noreferrer"}},[t._v("W3C"),a("OutboundLink")],1)])]),t._v(" "),a("blockquote",[a("p",[t._v("浏览器默认自带的头部字段都是满足安全规范的，只要开发者不改动和新增头部，就不会打破此条规则")])]),t._v(" "),a("blockquote",[a("p",[t._v("常见的安全字段有："),a("code",[t._v("Accept")]),t._v(" "),a("code",[t._v("Accept-Language")]),t._v(" "),a("code",[t._v("Content-Language")]),t._v(" "),a("code",[t._v("Content-Type")]),t._v(" "),a("code",[t._v("DPR")]),t._v(" "),a("code",[t._v("Downlink")]),t._v(" "),a("code",[t._v("Save-Data")]),t._v(" "),a("code",[t._v("Viewport-Width")]),t._v(" "),a("code",[t._v("Width")])])])]),t._v(" "),a("li",[a("ol",{attrs:{start:"3"}},[a("li",[t._v("如果有"),a("code",[t._v("Content-Type")]),t._v("，必须是下列值中的一个")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("text/plain")])]),t._v(" "),a("li",[a("code",[t._v("multipart/form-data")])]),t._v(" "),a("li",[a("code",[t._v("application/x-www-form-urlencoded")])])])])]),t._v(" "),a("h2",{attrs:{id:"预检请求-preflight"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#预检请求-preflight"}},[t._v("#")]),t._v(" 预检请求(preflight)")]),t._v(" "),a("p",[t._v("只要不是简单请求，均为预检请求")]),t._v(" "),a("h4",{attrs:{id:"预检请求流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#预检请求流程"}},[t._v("#")]),t._v(" 预检请求流程")]),t._v(" "),a("ul",[a("li",[a("ol",[a("li",[t._v("浏览器发送预检请求，询问服务器是否允许")])])]),t._v(" "),a("li",[a("ol",{attrs:{start:"2"}},[a("li",[t._v("服务器允许")])])]),t._v(" "),a("li",[a("ol",{attrs:{start:"3"}},[a("li",[t._v("浏览器发送真实请求")])])]),t._v(" "),a("li",[a("ol",{attrs:{start:"4"}},[a("li",[t._v("服务器完成真实的响应")])])])]),t._v(" "),a("p",[t._v("比如，在页面"),a("code",[t._v("http://my.com/index.html")]),t._v("中有以下代码造成了跨域"),a("br"),t._v(" "),a("strong",[t._v("1. 浏览器发送预检请求，询问服务器是否允许")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("OPTIONS")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("api"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("user "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HTTP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("Host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" crossdomain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("Origin")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com\nAccess"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Request"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Method"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("POST")]),t._v("\nAccess"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Request"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Headers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" content"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("type\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("可以看出，这并非我们想要发出的真实请求，请求中不包含我们的响应头，也没有消息体。")]),t._v(" "),a("p",[t._v("这是一个预检请求，它的目的是询问服务器，是否允许后续的真实请求。")]),t._v(" "),a("p",[t._v("预检请求没有请求体，它包含了后续真实请求要做的事情")]),t._v(" "),a("p",[t._v("预检请求有以下特征：")]),t._v(" "),a("ul",[a("li",[t._v("请求方法为OPTIONS")]),t._v(" "),a("li",[t._v("没有请求体")]),t._v(" "),a("li",[t._v("请求头中包含\n"),a("ul",[a("li",[a("code",[t._v("Origin")]),t._v("：请求的源，和简单请求的含义一致")]),t._v(" "),a("li",[a("code",[t._v("Access-Control-Request-Method")]),t._v("：后续的真实请求将使用的请求方法")]),t._v(" "),a("li",[a("code",[t._v("Access-Control-Request-Headers")]),t._v("：后续的真实请求会改动的请求头")])])])]),t._v(" "),a("p",[a("strong",[t._v("2. 服务器允许")]),a("br"),t._v("\n服务器收到预检请求后，可以检查预检请求中包含的信息，如果允许这样的请求，需要响应下面的消息格式")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HTTP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("OK")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("Date")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Tue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(" Apr "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("08")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("03")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("35")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GMT")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\nAccess"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Allow"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Origin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com\nAccess"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Allow"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Methods"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("POST")]),t._v("\nAccess"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Allow"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Headers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" content"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("type\nAccess"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Max"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Age"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("86400")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("p",[t._v("对于预检请求，不需要响应任何的消息体，只需要在响应头中添加：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Access-Control-Allow-Origin")]),t._v("：和简单请求一样，表示允许的源")]),t._v(" "),a("li",[a("code",[t._v("Access-Control-Allow-Methods")]),t._v("：表示允许的后续真实的请求方法")]),t._v(" "),a("li",[a("code",[t._v("Access-Control-Allow-Headers")]),t._v("：表示允许改动的请求头")]),t._v(" "),a("li",[a("code",[t._v("Access-Control-Max-Age")]),t._v("：告诉浏览器，多少秒内，对于同样的请求源、方法、头，都不需要再发送预检请求了")])]),t._v(" "),a("p",[a("strong",[t._v("3. 浏览器发送真实请求")]),a("br"),t._v("\n预检被服务器允许后，浏览器就会发送真实请求了，上面的代码会发生下面的请求数据")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("POST")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("api"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("user "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HTTP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("Host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" crossdomain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com\n"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("Connection")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" keep"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("alive\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("Referer")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html\n"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("Origin")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"张三"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"age"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("p",[a("strong",[t._v("4. 服务器响应真实请求")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HTTP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("OK")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("Date")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Tue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(" Apr "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("08")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("03")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("35")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GMT")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\nAccess"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Allow"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Origin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n\n添加用户成功\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("可以看出，当完成预检之后，后续的处理与简单请求相同")]),t._v(" "),a("h4",{attrs:{id:"问-文件上传是不是简单请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问-文件上传是不是简单请求"}},[t._v("#")]),t._v(" 问：文件上传是不是简单请求")]),t._v(" "),a("blockquote",[a("p",[t._v("不一定\n文件上传也可能修改header，也可能不使用"),a("code",[t._v("multipart/form-data")]),t._v("类型，以base64上传一个文件都是能上传文件，所以单说文件上传不一定就是简单请求")])]),t._v(" "),a("h4",{attrs:{id:"练习"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#练习"}},[t._v("#")]),t._v(" 练习")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("练习")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 下面的跨域请求哪些是简单请求，哪些是预检请求")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1  是简单请求，fetch默认是get请求")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://douyin.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2  预检请求，因为自定义了头部header")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://douyin.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("headers")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("a")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3  是简单请求，post且未修改header")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://douyin.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("method")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("body")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("a")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("b")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 4 预检请求，修改了content-type")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://douyin.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("method")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("headers")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'content-type'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'application/json'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("body")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("a")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("b")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br")])])]),t._v(" "),a("h4",{attrs:{id:"对简单请求的验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对简单请求的验证"}},[t._v("#")]),t._v(" 对简单请求的验证")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/img/network/17.png"),alt:"图片"}}),t._v(" "),a("h4",{attrs:{id:"对预检请求的验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对预检请求的验证"}},[t._v("#")]),t._v(" 对预检请求的验证")]),t._v(" "),a("ol",[a("li",[t._v("发送预检请求")])]),t._v(" "),a("img",{attrs:{src:t.$withBase("/img/network/18.png"),alt:"图片"}}),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("发送真实请求（和简单请求一致）")])]),t._v(" "),a("h2",{attrs:{id:"附带身份凭证的请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#附带身份凭证的请求"}},[t._v("#")]),t._v(" 附带身份凭证的请求")]),t._v(" "),a("p",[t._v("默认情况下，ajax的跨域请求并不会附带cookie，这样一来，某些需要权限的操作就无法进行")]),t._v(" "),a("p",[t._v("不过可以通过简单的配置就可以实现附带cookie")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// xhr")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" xhr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("withCredentials "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// fetch api")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("credentials")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"include"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("p",[t._v("这样一来，该跨域的ajax请求就是一个"),a("em",[t._v("附带身份凭证的请求")])]),t._v(" "),a("p",[t._v("当一个请求需要附带cookie时，无论它是简单请求，还是预检请求，都会在请求头中添加"),a("code",[t._v("cookie")]),t._v("字段")]),t._v(" "),a("p",[t._v("而服务器响应时，需要明确告知客户端：服务器允许这样的凭据")]),t._v(" "),a("p",[t._v("告知的方式也非常的简单，只需要在响应头中添加："),a("code",[t._v("Access-Control-Allow-Credentials: true")]),t._v("即可")]),t._v(" "),a("p",[t._v("对于一个附带身份凭证的请求，若服务器没有明确告知，浏览器仍然视为跨域被拒绝。")]),t._v(" "),a("p",[t._v("另外要特别注意的是："),a("strong",[t._v("对于附带身份凭证的请求，服务器不得设置 "),a("code",[t._v("Access-Control-Allow-Origin 的值为*")])]),t._v("。这就是为什么不推荐使用*的原因")]),t._v(" "),a("h2",{attrs:{id:"关于跨域获取响应头"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关于跨域获取响应头"}},[t._v("#")]),t._v(" 关于跨域获取响应头")]),t._v(" "),a("p",[t._v("在跨域访问时，JS只能拿到一些最基本的响应头，如：Cache-Control、Content-Language、Content-Type、Expires、Last-Modified、Pragma，如果要访问其他头，则需要服务器设置本响应头。")]),t._v(" "),a("p",[a("code",[t._v("Access-Control-Expose-Headers")]),t._v("头让服务器把允许浏览器访问的头放入白名单，例如：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Access-Control-Expose-Headers: authorization, a, b\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("这样JS就能够访问指定的响应头了。")]),t._v(" "),a("h2",{attrs:{id:"jsonp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jsonp"}},[t._v("#")]),t._v(" JSONP")]),t._v(" "),a("p",[t._v("在很久很久以前...并没有CORS方案")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/img/network/19.png"),alt:"图片"}}),t._v(" "),a("p",[t._v("在那个年代，古人靠着非凡的智慧来解决这一问题")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/img/network/20.png"),alt:"图片"}}),t._v(" "),a("p",[t._v("虽然可以解决问题，但JSONP有着明显的缺陷：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("仅能使用GET请求")])]),t._v(" "),a("li",[a("p",[t._v("容易产生安全隐患")]),t._v(" "),a("blockquote",[a("p",[t._v("恶意攻击者可能利用"),a("code",[t._v("callback=恶意函数")]),t._v("的方式实现"),a("code",[t._v("XSS")]),t._v("攻击")])])]),t._v(" "),a("li",[a("p",[t._v("容易被非法站点恶意调用")])])]),t._v(" "),a("p",[a("strong",[t._v("因此，除非是某些特殊的原因，否则永远不应该使用JSONP")])]),t._v(" "),a("h2",{attrs:{id:"代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#代理"}},[t._v("#")]),t._v(" 代理")]),t._v(" "),a("p",[t._v("CORS和JSONP均要求服务器是「自己人」")]),t._v(" "),a("p",[t._v("那如果不是呢？\n"),a("img",{attrs:{src:t.$withBase("/img/network/24.png"),alt:"图片"}})]),t._v(" "),a("p",[t._v("那就找一个中间人（代理）")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/img/network/22.png"),alt:"图片"}}),t._v(" "),a("p",[t._v("比如，前端小王想要请求获取王者荣耀英雄数据，但直接请求腾讯服务器会造成跨域")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/img/network/23.png"),alt:"图片"}}),t._v(" "),a("p",[t._v("由于腾讯服务器不是「自己人」，小王决定用代理解决")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/img/network/25.png"),alt:"图片"}}),t._v(" "),a("h3",{attrs:{id:"如何选择"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何选择"}},[t._v("#")]),t._v(" 如何选择")]),t._v(" "),a("p",[t._v("最重要的，是要保持"),a("strong",[t._v("生产环境和开发环境一致")])]),t._v(" "),a("p",[t._v("下面是一张决策图")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/img/network/26.png"),alt:"图片"}}),t._v(" "),a("p",[t._v("具体的几种场景")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/img/network/27.png"),alt:"图片"}}),t._v(" "),a("img",{attrs:{src:t.$withBase("/img/network/28.png"),alt:"图片"}})])}),[],!1,null,null,null);s.default=e.exports}}]);