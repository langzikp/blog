(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{515:function(a,t,e){"use strict";e.r(t);var r=e(62),s=Object(r.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"微信公众号h5配置流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#微信公众号h5配置流程"}},[a._v("#")]),a._v(" 微信公众号H5配置流程")]),a._v(" "),e("blockquote",[e("p",[a._v("会员关注企业公众号时，微信会生成一个oppenid，将oppenid与会员绑定，则可利用其完成会员自动登录，减少每次登录输入账号密码的麻烦；同时利用oppenid可以给指定会员推送消息，如积分变动，电子券使用等，而为了获取oppenid则需要完成以下配置")])]),a._v(" "),e("blockquote",[e("p",[a._v("公众号应为已认证的服务号")])]),a._v(" "),e("ul",[e("li",[a._v("示例：会员系统以及会员H5所在服务器域名为：www.abacus.com")])]),a._v(" "),e("h3",{attrs:{id:"_1-登录微信公众平台https-mp-weixin-qq-com-获取公众号appid和appsecret-设置ip白名单"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-登录微信公众平台https-mp-weixin-qq-com-获取公众号appid和appsecret-设置ip白名单"}},[a._v("#")]),a._v(" 1.\t登录微信公众平台https://mp.weixin.qq.com，获取公众号AppId和AppSecret，设置IP白名单")]),a._v(" "),e("p",[a._v("登录地址：  "),e("a",{attrs:{href:"https://mp.weixin.qq.com/",target:"_blank",rel:"noopener noreferrer"}},[a._v("微信公众平台"),e("OutboundLink")],1),e("br"),a._v(" "),e("img",{attrs:{src:a.$withBase("/img/wechat/1.png"),alt:"图片"}}),e("br"),a._v(" "),e("img",{attrs:{src:a.$withBase("/img/wechat/2.png"),alt:"图片"}}),e("br"),a._v(" "),e("strong",[a._v("注意")]),a._v("：1.AppSecret请妥善保存（后面要用），为保障帐号安全，公众平台不再储存AppSecret；如果遗忘，请重置。")]),a._v(" "),e("h3",{attrs:{id:"_2-ip白名单设置的ip为www-abacus-com对应ip。"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-ip白名单设置的ip为www-abacus-com对应ip。"}},[a._v("#")]),a._v(" 2.\tIP白名单设置的ip为www.abacus.com对应ip。")]),a._v(" "),e("img",{attrs:{src:a.$withBase("/img/wechat/3.png"),alt:"图片"}}),a._v(" "),e("img",{attrs:{src:a.$withBase("/img/wechat/4.png"),alt:"图片"}}),a._v(" "),e("p",[e("strong",[a._v("注意")]),a._v("：如果需要使用扫码赠券功能，需要利用微信接口唤起摄像头，需配置JS接口安全域名为www.abacus.com。")]),a._v(" "),e("h3",{attrs:{id:"_3-在后台系统中配置第1步获取的appid和secret"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-在后台系统中配置第1步获取的appid和secret"}},[a._v("#")]),a._v(" 3.在后台系统中配置第1步获取的appid和secret")]),a._v(" "),e("p",[a._v("老项目："),e("br"),a._v("\n在sms系统管理中或abacus.properties配置文件中设置参数：mbr.weixin.appid和mbr.weixin.secret。")]),a._v(" "),e("p",[a._v("新项目："),e("br"),a._v("\n在acas权限管理中配置，分为 集团会员 和 非集团会员 两种情况。")]),a._v(" "),e("p",[a._v("可根据配置文件参数mbr.useManafirm来判断；设置为true，使用集团账户，默认为false。"),e("br"),a._v("\n项目为非集团会员时配置：")]),a._v(" "),e("img",{attrs:{src:a.$withBase("/img/wechat/5.png"),alt:"图片"}}),a._v("  \n为集团会员时配置：  \n"),e("img",{attrs:{src:a.$withBase("/img/wechat/6.png"),alt:"图片"}}),a._v(" "),e("img",{attrs:{src:a.$withBase("/img/wechat/7.png"),alt:"图片"}}),a._v(" "),e("h3",{attrs:{id:"_4-生成登录地址-将以下链接中的appid和-redirect-uri-替换为对应的appid和域名www-abacus-com即可。"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-生成登录地址-将以下链接中的appid和-redirect-uri-替换为对应的appid和域名www-abacus-com即可。"}},[a._v("#")]),a._v(" 4.生成登录地址:将以下链接中的APPID和 REDIRECT_URI 替换为对应的APPID和域名www.abacus.com即可。")]),a._v(" "),e("p",[a._v("https://open.weixin.qq.com/connect/oauth2/authorize?appid="),e("strong",[a._v("APPID")]),a._v("&redirect_uri=http%3a%2f%2f"),e("strong",[a._v("REDIRECT_URI")]),a._v("%2fmember%2fapp%2fbasic%2fweixinCodeLogin&response_type=%20code&scope=snsapi_userinfo&state=200&connect_redirect=1#wechat_redirect")]),a._v(" "),e("h3",{attrs:{id:"_5-将4中拼接而成的地址-配置到公众号菜单"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-将4中拼接而成的地址-配置到公众号菜单"}},[a._v("#")]),a._v(" 5.将4中拼接而成的地址，配置到公众号菜单")]),a._v(" "),e("img",{attrs:{src:a.$withBase("/img/wechat/8.png"),alt:"图片"}}),a._v(" "),e("p",[e("strong",[a._v("完成以上，即可使用公众号登录会员H5。")])]),a._v(" "),e("h2",{attrs:{id:"注意"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#注意"}},[a._v("#")]),a._v(" 注意："),e("Badge",{attrs:{text:"注意"}})],1),a._v(" "),e("ol",[e("li",[a._v("第"),e("strong",[a._v("4")]),a._v("完成后，可将链接拷贝至微信，看能否正常跳转到会员H5，再绑定第"),e("strong",[a._v("5")]),a._v("步，减少重复修改")]),a._v(" "),e("li",[a._v("加载图片验证码时可能出错\n"),e("img",{attrs:{src:a.$withBase("/img/wechat/9.png"),alt:"图片"}}),a._v("\n原因是生成图片需要在Headless模式下，在会员系统tomcat/bin/catalina.sh文件中\n在所有类似以下代码："),e("br"),a._v('\n"$_RUNJAVA" $JAVA_OPTS $CATALINA_OPTS \\'),e("br"),a._v('\n-Djava.endorsed.dirs="$JAVA_ENDORSED_DIRS" -classpath "$CLASSPATH" \\'),e("br"),a._v("\n-Djava.security.manager \\"),e("br"),a._v('\n-Djava.security.policy=="$CATALINA_BASE"/conf/catalina.policy \\'),e("br"),a._v('\n-Dcatalina.base="$CATALINA_BASE" \\'),e("br"),a._v('\n-Dcatalina.home="$CATALINA_HOME" \\'),e("br"),a._v('\n-Djava.io.tmpdir="$CATALINA_TMPDIR" \\')])]),a._v(" "),e("p",[a._v("在尾部加上一句：\n-Djava.awt.headless=true \\")]),a._v(" "),e("p",[a._v("修改后内容如下："),e("br"),a._v('\nexec "$_RUNJAVA" $JAVA_OPTS $CATALINA_OPTS \\'),e("br"),a._v('\n-Djava.endorsed.dirs="$JAVA_ENDORSED_DIRS" -classpath "$CLASSPATH" \\'),e("br"),a._v('\n-Dcatalina.base="$CATALINA_BASE" \\'),e("br"),a._v('\n-Dcatalina.home="$CATALINA_HOME" \\'),e("br"),a._v('\n-Djava.io.tmpdir="$CATALINA_TMPDIR" \\'),e("br"),a._v("\n-Djava.awt.headless=true \\")]),a._v(" "),e("p",[a._v("以tomcat6.0为例，总共有七处这样的地方。然后重启tomcat服务器"),e("br"),a._v("\n3. 可在 wechat/js/config/abacus-basic-config.js中修改项目名称，公司logo,幻灯片，推送广告等。"),e("br"),a._v("\n4. 部分机型使用附近门店获取定位不精确的情况，其原因如下：\n"),e("img",{attrs:{src:a.$withBase("/img/wechat/10.png"),alt:"图片"}})])])}),[],!1,null,null,null);t.default=s.exports}}]);