(window.webpackJsonp=window.webpackJsonp||[]).push([[169],{603:function(v,_,a){"use strict";a.r(_);var t=a(34),e=Object(t.a)({},(function(){var v=this,_=v.$createElement,a=v._self._c||_;return a("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[a("h2",{attrs:{id:"缓存的基本原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存的基本原理"}},[v._v("#")]),v._v(" 缓存的基本原理")]),v._v(" "),a("p",[v._v("在一个C/S结构中，最基本的缓存分为两种：")]),v._v(" "),a("ul",[a("li",[v._v("客户端缓存")]),v._v(" "),a("li",[v._v("服务器缓存")])]),v._v(" "),a("p",[a("strong",[v._v("本文仅讨论客户端缓存")])]),v._v(" "),a("p",[v._v("所谓"),a("strong",[v._v("客户端缓存")]),v._v("，顾名思义，是将某一次的响应结果保存在客户端（比如浏览器）中，而后续的请求仅需要从缓存中读取即可，极大的降低了服务器的处理压力。")]),v._v(" "),a("p",[v._v("客户端缓存的原理如下：")]),v._v(" "),a("p",[a("img",{attrs:{src:"http://mdrs.yuanjin.tech/img/image-20200430202446870.png",alt:"image-20200430202446870"}})]),v._v(" "),a("blockquote",[a("p",[v._v("这只是一个简易的原理图，实际情况可能有差异")])]),v._v(" "),a("p",[v._v("这里就设计到一个缓存策略的问题，这些问题包括：")]),v._v(" "),a("ul",[a("li",[v._v("哪些资源需要加入到缓存，哪些不需要？")]),v._v(" "),a("li",[v._v("缓存的时间是多久呢？")]),v._v(" "),a("li",[v._v("如果服务器的资源有改动，客户端如何更新缓存呢？")]),v._v(" "),a("li",[v._v("如果缓存过期了，可是服务器上的资源并没有发生变动，又该如何处理呢？")]),v._v(" "),a("li",[v._v(".......")])]),v._v(" "),a("p",[v._v("要回答这些问题，就必须要清楚"),a("code",[v._v("http")]),v._v("中关于缓存的协议")]),v._v(" "),a("p",[v._v("理解了http的缓存协议，自然就能回答上面的问题了。")]),v._v(" "),a("h2",{attrs:{id:"来自服务器的缓存指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#来自服务器的缓存指令"}},[v._v("#")]),v._v(" 来自服务器的缓存指令")]),v._v(" "),a("p",[v._v("当客户端发出一个"),a("code",[v._v("get")]),v._v("请求到服务器，服务器可能有以下的内心活动：「你请求的这个资源，我很少会改动它，干脆你把它缓存起来吧，以后就不要来烦我了」")]),v._v(" "),a("p",[v._v("为了表达这个美好的愿望，服务器在"),a("strong",[v._v("响应头")]),v._v("中加入了以下内容：")]),v._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[v._v('Cache-Control: max-age=3600\nETag: W/"121-171ca289ebf"\nDate: Thu, 30 Apr 2020 12:39:56 GMT\nLast-Modified: Thu, 30 Apr 2020 08:16:31 GMT\n')])]),v._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[v._v("1")]),a("br"),a("span",{staticClass:"line-number"},[v._v("2")]),a("br"),a("span",{staticClass:"line-number"},[v._v("3")]),a("br"),a("span",{staticClass:"line-number"},[v._v("4")]),a("br")])]),a("p",[v._v("这个响应头表达了下面的信息：")]),v._v(" "),a("ul",[a("li",[a("code",[v._v("Cache-Control: max-age=3600")]),v._v("，我希望你把这个资源缓存起来，缓存时间是3600秒（1小时）")]),v._v(" "),a("li",[a("code",[v._v('ETag: W/"121-171ca289ebf"')]),v._v("，这个资源的编号是"),a("code",[v._v('W/"121-171ca289ebf"')])]),v._v(" "),a("li",[a("code",[v._v("Date: Thu, 30 Apr 2020 12:39:56 GMT")]),v._v("，我给你响应这个资源的服务器时间是格林威治时间"),a("code",[v._v("2020-04-30 12:39:56")])]),v._v(" "),a("li",[a("code",[v._v("Last-Modified: Thu, 30 Apr 2020 08:16:31 GMT")]),v._v("，这个资源的上一次修改时间是格林威治时间"),a("code",[v._v("2020-04-30 08:16:31")])])]),v._v(" "),a("p",[v._v("这个美好的缓存愿望，就这样通过响应头传递给客户端了")]),v._v(" "),a("p",[v._v("如果客户端是其他应用程序，可能并不会理会服务器的愿望，也就是说，可能根本不会缓存任何东西。")]),v._v(" "),a("p",[v._v("但是凑巧客户端是一个浏览器，它和服务器一直以来都是相亲相爱的小伙伴，当它看到服务器的这个响应头表达的美好愿望后，立即忙起来：")]),v._v(" "),a("ul",[a("li",[v._v("浏览器把这次请求得到的响应体缓存到本地文件中")]),v._v(" "),a("li",[v._v("浏览器标记这次请求的请求方法和请求路径")]),v._v(" "),a("li",[v._v("浏览器标记这次缓存的时间是3600秒")]),v._v(" "),a("li",[v._v("浏览器记录服务器的响应时间是格林威治时间"),a("code",[v._v("2020-04-30 12:39:56")])]),v._v(" "),a("li",[v._v("浏览器记录服务器给予的资源编号"),a("code",[v._v('W/"121-171ca289ebf"')])]),v._v(" "),a("li",[v._v("浏览器记录资源的上一次修改时间是格林威治时间"),a("code",[v._v("2020-04-30 08:16:31")])])]),v._v(" "),a("p",[v._v("这一次的记录非常重要，它为以后浏览器要不要去请求服务器提供了各种依据。")]),v._v(" "),a("p",[a("img",{attrs:{src:"http://mdrs.yuanjin.tech/img/image-20200430210430455.png",alt:"image-20200430210430455"}})]),v._v(" "),a("h2",{attrs:{id:"来自客户端的缓存指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#来自客户端的缓存指令"}},[v._v("#")]),v._v(" 来自客户端的缓存指令")]),v._v(" "),a("p",[v._v("当客户端收拾好行李，准备再次请求"),a("code",[v._v("GET /index.js")]),v._v("时，它突然想起了一件事：我需要的东西在不在缓存里呢？")]),v._v(" "),a("p",[v._v("此时，客户端会到缓存中去寻找是否有缓存的资源")]),v._v(" "),a("p",[v._v("寻找的过程如下：")]),v._v(" "),a("ol",[a("li",[v._v("缓存中是否有匹配的请求方法和路径？")]),v._v(" "),a("li",[v._v("如果有，该缓存资源是否还有效呢？")])]),v._v(" "),a("p",[v._v("以上两个验证会导致浏览器产生不同的行为")]),v._v(" "),a("p",[a("img",{attrs:{src:"http://mdrs.yuanjin.tech/img/image-20200430212052228.png",alt:"image-20200430212052228"}}),a("img",{attrs:{src:"http://mdrs.yuanjin.tech/img/image-20200430214301507.png",alt:"image-20200430214301507"}})]),v._v(" "),a("p",[v._v("要验证是否有匹配的缓存非常简单，只需要验证当前的请求方法"),a("code",[v._v("GET")]),v._v("和当前的请求路径"),a("code",[v._v("/index.js")]),v._v("是否有对应的缓存存在即可")]),v._v(" "),a("p",[v._v("如果没有，就直接请求服务器，就和第一次请求服务器时一样，这种情况没有什么好讨论的")]),v._v(" "),a("p",[v._v("关键在于验证缓存是否有效")]),v._v(" "),a("p",[v._v("如何验证呢？")]),v._v(" "),a("p",[v._v("非常简单，就是把"),a("code",[v._v("max-age + Date")]),v._v("，得到一个过期时间，看看这个过期时间是否大于当前时间，如果是，则表示缓存还没有过期，仍然有效，如果不是，则表示缓存失效。")]),v._v(" "),a("h2",{attrs:{id:"缓存有效"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存有效"}},[v._v("#")]),v._v(" 缓存有效")]),v._v(" "),a("p",[v._v("当浏览器发现缓存有效时，完全不会请求服务器，直接使用缓存即可得到结果")]),v._v(" "),a("p",[v._v("此时，如果你断开网络，会发现资源仍然可用")]),v._v(" "),a("p",[v._v("这种情况会极大的降低服务器压力，但当服务器更改了资源后，浏览器是不知道的，只要缓存有效，它就会直接使用缓存")]),v._v(" "),a("h2",{attrs:{id:"缓存无效"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存无效"}},[v._v("#")]),v._v(" 缓存无效")]),v._v(" "),a("p",[v._v("当浏览器发现缓存已经过期，它"),a("strong",[v._v("并不会简单的把缓存删除")]),v._v("，而是抱着一丝希望，想问问服务器，我"),a("strong",[v._v("这个缓存还能继续使用吗")]),v._v("？")]),v._v(" "),a("p",[v._v("于是，浏览器向服务器发出了一个"),a("strong",[v._v("带缓存的请求")]),v._v("，又称之为"),a("strong",[v._v("协商缓存")])]),v._v(" "),a("p",[v._v("所谓带缓存的请求，无非就是加入了以下的请求头：")]),v._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[v._v('If-Modified-Since: Thu, 30 Apr 2020 08:16:31 GMT\nIf-None-Match: W/"121-171ca289ebf"\n')])]),v._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[v._v("1")]),a("br"),a("span",{staticClass:"line-number"},[v._v("2")]),a("br")])]),a("p",[v._v("它们表达了下面的信息：")]),v._v(" "),a("ul",[a("li",[a("code",[v._v("If-Modified-Since: Thu, 30 Apr 2020 08:16:31 GMT")]),v._v("，亲，你曾经告诉我，这个资源的上一次修改时间是格林威治时间"),a("code",[v._v("2020-04-30 08:16:31")]),v._v("，请问这个资源在这个时间之后有发生变动吗？")]),v._v(" "),a("li",[a("code",[v._v('If-None-Match: W/"121-171ca289ebf"')]),v._v("，亲，你曾经告诉我，这个资源的编号是"),a("code",[v._v('W/"121-171ca289ebf')]),v._v("，请问这个资源的编号发生变动了吗？")])]),v._v(" "),a("p",[v._v("其实，这两个问题可以合并为一个问题：快说！资源到底变了没有！")]),v._v(" "),a("p",[v._v("之所以要发两个信息，是为了兼容不同的服务器，因为有些服务器只认"),a("code",[v._v("If-Modified-Since")]),v._v("，有些服务器只认"),a("code",[v._v("If-None-Match")]),v._v("，有些服务器两个都认")]),v._v(" "),a("blockquote",[a("p",[v._v("目前的很多服务器，只要发现"),a("code",[v._v("If-None-Match")]),v._v("存在，就不会去看``If-Modified-Since`")]),v._v(" "),a("p",[a("code",[v._v("If-Modified-Since")]),v._v("是"),a("code",[v._v("http1.0")]),v._v("版本的规范，"),a("code",[v._v("If-None-Match")]),v._v("是"),a("code",[v._v("http1.1")]),v._v("的规范")])]),v._v(" "),a("p",[v._v("此时，问题又抛给了服务器，接下来，就是服务器的表演时间了")]),v._v(" "),a("p",[v._v("服务器可能会产生两个情况：")]),v._v(" "),a("ul",[a("li",[v._v("缓存已经失效")]),v._v(" "),a("li",[v._v("缓存仍然有效")])]),v._v(" "),a("p",[v._v("如果是第一种情况——"),a("strong",[v._v("缓存已经失效")]),v._v("，那么非常简单，服务器再次给予一个正常的响应（响应码"),a("code",[v._v("200")]),v._v(" 带响应体），同时可以附带上新的缓存指令，这就回到了上一节——来自服务器的缓存指令")]),v._v(" "),a("p",[v._v("这样一来，客户端就会重新缓存新的内容")]),v._v(" "),a("p",[v._v("但如果服务器觉得"),a("strong",[v._v("缓存仍然有效")]),v._v("，它可以通过一种极其简单的方式告诉客户端：")]),v._v(" "),a("ul",[a("li",[v._v("响应码为"),a("code",[v._v("304 Not Modified")])]),v._v(" "),a("li",[v._v("无响应体")]),v._v(" "),a("li",[v._v("响应头带上新的缓存指令，见上一节——来自服务器的缓存指令")])]),v._v(" "),a("p",[v._v("这样一来，就相当于告诉客户端：「你的缓存资源仍然可用，我给你一个新的缓存时间，你那边更新一下就可以了」")]),v._v(" "),a("p",[v._v("于是，客户端就继续happy的使用缓存了")]),v._v(" "),a("p",[v._v("这样一来，可以最大程度的减少网络传输，因为如果资源还有效，服务器就不会传输消息体")]),v._v(" "),a("p",[v._v("它们完整的交互过程如下：")]),v._v(" "),a("p",[a("img",{attrs:{src:"http://mdrs.yuanjin.tech/img/image-20200430225326001.png",alt:"image-20200430225326001"}})]),v._v(" "),a("h2",{attrs:{id:"细节"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#细节"}},[v._v("#")]),v._v(" 细节")]),v._v(" "),a("p",[v._v("上面描述了客户端缓存的基本概念和过程")]),v._v(" "),a("p",[v._v("但其中仍然有不少细节值得我们注意")]),v._v(" "),a("h2",{attrs:{id:"cache-control"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cache-control"}},[v._v("#")]),v._v(" Cache-Control")]),v._v(" "),a("p",[v._v("在上述的讲解中，"),a("code",[v._v("Cache-Control")]),v._v("是服务器向客户端响应的一个消息头，它提供了一个"),a("code",[v._v("max-age")]),v._v("用于指定缓存时间。")]),v._v(" "),a("p",[v._v("实际上，"),a("code",[v._v("Cache-Control")]),v._v("还可以设置下面一个或多个值：")]),v._v(" "),a("ul",[a("li",[a("code",[v._v("public")]),v._v("：表明响应可以被任何对象（包括：发送请求的客户端，代理服务器，等等）缓存，即使是通常不可缓存的内容。（例如：1.该响应没有max-age指令或Expires消息头；2. 该响应对应的请求方法是 POST 。）")]),v._v(" "),a("li",[a("code",[v._v("private")]),v._v("：表明响应只能被单个用户缓存，不能作为共享缓存（即代理服务器不能缓存它）。私有缓存可以缓存响应内容，比如：对应用户的本地浏览器。")]),v._v(" "),a("li",[a("code",[v._v("no-cache")]),v._v("：告知客户端，你可以缓存这个资源，但是不要"),a("strong",[v._v("直接")]),v._v("使用它。当你缓存之后，后续的每一次请求都需要附带缓存指令，让服务器告诉你这个资源有没有过期。见：「来自客户端的缓存指令 - 缓存无效」")]),v._v(" "),a("li",[a("code",[v._v("no-store")]),v._v("：告知客户端，不要对这个资源做任何的缓存，之后的每一次请求都按照正常的普通请求进行。若设置了这个值，浏览器将不会对该资源做出任何的缓存处理。")]),v._v(" "),a("li",[a("code",[v._v("max-age")]),v._v("：设置缓存存储的最大周期，超过这个时间缓存被认为过期 (单位秒)。与Expires相反，时间是相对于请求的时间。")]),v._v(" "),a("li",[a("code",[v._v("s-maxage=<seconds>")]),v._v("：覆盖max-age或者Expires头，但是仅适用于共享缓存 (比如各个代理)，私有缓存会忽略它。")])]),v._v(" "),a("p",[v._v("比如，"),a("code",[v._v("Cache-Control: public, max-age=3600")]),v._v("表示这是一个公开资源，请缓存1个小时。")]),v._v(" "),a("p",[a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cache-Control",target:"_blank",rel:"noopener noreferrer"}},[v._v("MDN Cache-Control"),a("OutboundLink")],1)]),v._v(" "),a("h2",{attrs:{id:"expires"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#expires"}},[v._v("#")]),v._v(" Expires")]),v._v(" "),a("p",[v._v("在"),a("code",[v._v("http1.0")]),v._v("版本中，是通过"),a("code",[v._v("Expires")]),v._v("响应头来指定过期时间点的，例如：")]),v._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[v._v("Expires: Thu, 30 Apr 2020 23:38:38 GMT\n")])]),v._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[v._v("1")]),a("br")])]),a("p",[v._v("到了"),a("code",[v._v("http1.1")]),v._v("版本，已更改为通过"),a("code",[v._v("Cache-Control")]),v._v("的"),a("code",[v._v("max-age")]),v._v("来记录了。")]),v._v(" "),a("h2",{attrs:{id:"记录缓存时的有效期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#记录缓存时的有效期"}},[v._v("#")]),v._v(" 记录缓存时的有效期")]),v._v(" "),a("p",[v._v("浏览器会按照服务器响应头的要求，自动记录缓存到本地文件，并设置各种相关信息")]),v._v(" "),a("p",[v._v("在这些信息中，"),a("strong",[v._v("有效期")]),v._v("尤为关键，它决定了这个缓存可以使用多久")]),v._v(" "),a("p",[v._v("浏览器会根据服务器不同的响应情况，设置不同的有效期")]),v._v(" "),a("p",[v._v("具体的有效期设置，按照下面的流程进行：")]),v._v(" "),a("p",[a("img",{attrs:{src:"http://mdrs.yuanjin.tech/img/image-20200501075337464.png",alt:"image-20200501075337464"}})]),v._v(" "),a("p",[v._v("例如，当"),a("code",[v._v("max-age")]),v._v("设置为0时，缓存立即过期")]),v._v(" "),a("p",[v._v("虽然立即过期，但缓存仍然被记录下来，后续的请求通过缓存指令发送到服务器，来确认资源是否被更改。")]),v._v(" "),a("p",[v._v("因此，"),a("code",[v._v("Cache-Control: max-age=0")]),v._v("类似于"),a("code",[v._v("Cache-Control: no-cache")])]),v._v(" "),a("h2",{attrs:{id:"pragma"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pragma"}},[v._v("#")]),v._v(" Pragma")]),v._v(" "),a("p",[v._v("这是"),a("code",[v._v("http1.0")]),v._v("版本的消息头")]),v._v(" "),a("p",[v._v("当该消息头出现在请求中时，是向服务器表达：不要考虑任何缓存，给我一个正常的结果。")]),v._v(" "),a("p",[v._v("在"),a("code",[v._v("http1.1")]),v._v("版本中，可以在"),a("strong",[v._v("请求头")]),v._v("中加入"),a("code",[v._v("Cache-Control: no-cache")]),v._v("实现同样的含义。")]),v._v(" "),a("blockquote",[a("p",[v._v("是的，"),a("code",[v._v("Cache-Control")]),v._v("可以出现在请求头中")])]),v._v(" "),a("p",[v._v("在"),a("code",[v._v("Chrome")]),v._v("浏览器中调试时，如果勾选了"),a("code",[v._v("Disable cache")]),v._v("，则发送的请求中会附带该信息")]),v._v(" "),a("p",[a("img",{attrs:{src:"http://mdrs.yuanjin.tech/img/image-20200501080330131.png",alt:"image-20200501080330131"}})]),v._v(" "),a("h2",{attrs:{id:"vary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vary"}},[v._v("#")]),v._v(" Vary")]),v._v(" "),a("p",[v._v("有的时候，是否有缓存，不仅仅是判断请求方法和请求路径是否匹配，可能还要判断头部信息是否匹配。")]),v._v(" "),a("p",[v._v("此时，就可以使用"),a("code",[v._v("Vary")]),v._v("字段来指定要区分的消息头")]),v._v(" "),a("p",[v._v("比如，当使用"),a("code",[v._v("GET /personal.html")]),v._v("请求服务器时，请求头中"),a("code",[v._v("cookie")]),v._v("的值不一样，得到的页面也不一样")]),v._v(" "),a("p",[v._v("如果还按照之前的做法，仅仅匹配请求方法和请求路径，如果"),a("code",[v._v("cookie")]),v._v("变动，你可能得到的仍然是之前的页面。")]),v._v(" "),a("p",[v._v("正确的做法如下：")]),v._v(" "),a("p",[a("img",{attrs:{src:"http://mdrs.yuanjin.tech/img/image-20200501082103089.png",alt:"image-20200501082103089"}})]),v._v(" "),a("h2",{attrs:{id:"使用版本号或hash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用版本号或hash"}},[v._v("#")]),v._v(" 使用版本号或hash")]),v._v(" "),a("p",[v._v("如果你是一个前端工程师，使用过"),a("code",[v._v("vue")]),v._v("或其他基于"),a("code",[v._v("webpack")]),v._v("搭建的工程")]),v._v(" "),a("p",[v._v("你会发现打包的结果中很多文件名类似于这样：")]),v._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[v._v("app.68297cd8.css\n")])]),v._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[v._v("1")]),a("br")])]),a("p",[v._v("文件的中间部分使用了"),a("code",[v._v("hash")]),v._v("值")]),v._v(" "),a("p",[v._v("这样做的好处是，可以让客户端大胆的、长时间的缓存该文件，减轻服务器的压力")]),v._v(" "),a("p",[v._v("当文件改动后，它的文件"),a("code",[v._v("hash")]),v._v("值也会随之而变，比如变成了"),a("code",[v._v("app.446fccb8.css")])]),v._v(" "),a("p",[v._v("这样一来，客户端要请求新的文件时，就会发现路径从"),a("code",[v._v("/app.68297cd8.css")]),v._v("变成了"),a("code",[v._v("app.446fccb8.css")]),v._v("，由于之前的缓存路径无法匹配到，因此就会发送新的请求来获取新资源了。")]),v._v(" "),a("p",[v._v("以上是现代流行的做法。")]),v._v(" "),a("p",[v._v("而在古老的年代，还没有构建工具出现时，人们使用的办法是在资源路径后面加入版本号来获取新版本的文件")]),v._v(" "),a("p",[v._v("比如，页面中引入了一个css资源"),a("code",[v._v("app.css")]),v._v("，它可能的引入方式是：")]),v._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("<")]),v._v("link")]),v._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[v._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[v._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v('"')]),v._v("/app.css?v=1.0.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(">")])]),v._v("\n")])]),v._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[v._v("1")]),a("br")])]),a("p",[v._v("这样一来，缓存的路径是"),a("code",[v._v("/app.css?v=1.0.0")])]),v._v(" "),a("p",[v._v("当服务器的版本发生变化时，可以给予新的版本号，让html中的路径发生变动")]),v._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("<")]),v._v("link")]),v._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[v._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[v._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v('"')]),v._v("/app.css?v=1.0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(">")])]),v._v("\n")])]),v._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[v._v("1")]),a("br")])]),a("p",[v._v("由于新的路径无法命中缓存，于是浏览器就会发送新的普通请求来获取这个资源")]),v._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[v._v("#")]),v._v(" 总结")]),v._v(" "),a("p",[v._v("最后，通过客户端和服务器两位大佬的视角，来总结一下以上内容")]),v._v(" "),a("h2",{attrs:{id:"服务器视角"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器视角"}},[v._v("#")]),v._v(" 服务器视角")]),v._v(" "),a("p",[v._v("服务器无法知道客户端到底有没有像浏览器那样缓存文件，它只管根据请求的情况来决定如何响应")]),v._v(" "),a("p",[a("img",{attrs:{src:"http://mdrs.yuanjin.tech/img/image-20200501083702987.png",alt:"image-20200501083702987"}})]),v._v(" "),a("p",[v._v("很多后端语言搭建的服务器都会自带自己的默认缓存规则，当然也支持不同程度的修改")]),v._v(" "),a("h2",{attrs:{id:"浏览器视角"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#浏览器视角"}},[v._v("#")]),v._v(" 浏览器视角")]),v._v(" "),a("p",[v._v("浏览器在发出请求时会判断要不要使用缓存")]),v._v(" "),a("p",[a("img",{attrs:{src:"http://mdrs.yuanjin.tech/img/image-20200501084258712.png",alt:"image-20200501084258712"}})]),v._v(" "),a("p",[v._v("当收到服务器响应时，会自动根据缓存指令进行处理")]),v._v(" "),a("p",[a("img",{attrs:{src:"http://mdrs.yuanjin.tech/img/image-20200501084559394.png",alt:"image-20200501084559394"}})])])}),[],!1,null,null,null);_.default=e.exports}}]);